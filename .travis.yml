language: android

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"

android:
  components:
  - tools
  - tools
  - platform-tools
  - build-tools-26.0.2
  - android-26

env:
  global:
  - secure: sy1tScXwmeOXUsLECfA/l57NX7sckCtaDu6SLH7uHMRY/EDRcUpiXGQsePINOxfsoeEXDwsFSxFu61A1KKgjh4GZSCFnI7leQjD9dhxSW+NnDWbNmKwBeKc8Y5ZHv8LPMu4vyugbA8/QoINIDgFdFqAJqbnZXa7pOj1V21u0o/OXAKYRQdOLqS6TLMFLn//sjMmnhJgx34rHA6LTcpSMxruf1HbGnh7sAWQzsiBSrl2vpC3zLyQYJA/fdMEnQ9ZXPcR7GbyYaY2RPueRTvr0pN2X4LpYUXnLKKtO3yb1cqFE4rw2Rsh3J/hTApvo+iz+N2nhqYDj75Jif9TxBEQGTkiWjbyAktl9mXtXBGwJUf1k5BsHWwqrc9995AtysPqlH3qOg0+QInE39thboYSzBWCYB6xgFvI2WVCq0Uzoi4+ml+Zjxci6nTTwUZBqKFL5J/kzO1B+zu6vaag1Sy7lenxZJCsQaYSJXB97Fy7Ei+W77K99oe2oAacNNu0hbbCsXS5OjOa3sWw4K6XvQcVbOX68TPjyW/QtCb2wOeoWLpQylBEYswlMnge8kz+8ELZZmEsUs09cflvBy9i0tEvR3RXyffpmt1Unepp6mJMrol5Fq1wIs/5F/8mAJ35Hv35Rrz5qxXoVQMxlZEOzRGj3hHnbH/h+Na0BXT+Elci2NSU=
  - secure: nqCGBafzHZxGhIIB/A7NyRDOY5DAJ9HrsBdeg2zdbraePXIz2hfVN/SkFgHaqe2qN0ngfyxtfnXmgJCWao0sofApXY7FQrP0pqOIbFeio2dMEZvzStAe0IXYvcyvLh+HZwPylr9/3i0Kb3sMDKsZ2PTJUWdQ3IMYbNw8E9Xm6TXWS2ITXXZ+YfclAr0EEC1Io1os3P3/Nw+wTRBJNy7IyTI8NdGyBOlwyhgb9B8EzWFfIYqM9xQpBE3i+sT6NYYG29UAs7x+KbCgl0TiW3+JGOzxtNVWn6DAaPEa7ELTXu1NMGLkiEWz2UvigSnTZzTLNn7EaOqSxCyte0noc9QWHwEhf8IRcKmGGpZKJRbTiHkfHl06eOq+LYxxW2nA4grc4dpqiN7MvCoUfVQSB+BzwHuqTdKcsNiN0zUaJt78PnNanMInK9+2BYOZm5GSyx9PG3N4dHhg0gDPOEWTntt7V5yXlbz5IhxtvMPh8SrOxyFPWtu542zNY03ZZ4SVrz0qndy9c8NaELSBl7EZY412xw6LfGPFi4+HC3676NBs/CeSY97RhoLuADaMBeSrmfUKr3c2Im7jUNy/wTvrHsgb2myvpWiDM6j/X7aAJgi8OzqvQQqIVO8QkuDBeqe8rSXmn5jnwumROKKmLj8ao67RBmIT7fhUpOSJdu3GsOsnt4M=

script:
- "./gradlew assembleRelease --stacktrace --no-daemon"

before_install:
- openssl aes-256-cbc -K $encrypted_4bb6d5505985_key -iv $encrypted_4bb6d5505985_iv
  -in private_keystore.jks.enc -out private_keystore.jks -d

before_deploy:
- cp $TRAVIS_BUILD_DIR/private_keystore.jks $HOME
- cd app/build/outputs/apk/
- jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore $HOME/private_keystore.jks -storepass $storepass -keypass $keypass app-release-unsigned.apk electride

# Verification
- jarsigner -verify app-release-unsigned.apk
- "${ANDROID_HOME}/build-tools/26.0.2/zipalign -v 4 app-release-unsigned.apk TravisExample.apk"

after_script:
- "./gradlew releaseNotes crashlyticsUploadDistributionRelease"
